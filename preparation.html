

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Data Preparation for Training &mdash; Neer Match Utilities 1.0.18-beta documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="_static/css/extra.css?v=503a7970" />
      <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/2.1.8/css/dataTables.dataTables.min.css" />

  
    <link rel="shortcut icon" href="_static/favicon.ico"/>
      <script src="_static/jquery.js?v=5d32c60e"></script>
      <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="_static/documentation_options.js?v=94af8357"></script>
      <script src="_static/doctools.js?v=9bcbadda"></script>
      <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
      <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
      <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
      <script src="https://cdn.datatables.net/2.1.8/js/dataTables.min.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Saving a Model" href="model_save.html" />
    <link rel="prev" title="Installation" href="install.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            Neer Match Utilities
              <img src="_static/logo.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Installation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="install.html">Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="install.html#pipy">PiPy</a></li>
<li class="toctree-l2"><a class="reference internal" href="install.html#from-source">From Source</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Examples</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Data Preparation for Training</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#different-data-relationships">Different Data Relationships</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#loading-the-data">1. Loading the Data</a></li>
<li class="toctree-l3"><a class="reference internal" href="#inspecting-the-data">2. Inspecting the Data</a></li>
<li class="toctree-l3"><a class="reference internal" href="#simulating-a-many-to-many-relationship">3. Simulating a Many-to-Many Relationship</a></li>
<li class="toctree-l3"><a class="reference internal" href="#understanding-the-matching-issue">4. Understanding the Matching Issue</a></li>
<li class="toctree-l3"><a class="reference internal" href="#correcting-the-relationships">5. Correcting the Relationships</a></li>
<li class="toctree-l3"><a class="reference internal" href="#verifying-the-adjustments">6. Verifying the Adjustments</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#formatting">Formatting</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#a-customized-similarity-map">1. A customized <code class="docutils literal notranslate"><span class="pre">similarity_map</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#harmonizing-the-data">2. Harmonizing the data</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#re-structuring">Re-Structuring</a></li>
<li class="toctree-l2"><a class="reference internal" href="#splitting-data">Splitting data</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="model_save.html">Saving a Model</a><ul>
<li class="toctree-l2"><a class="reference internal" href="model_save.html#prepare-the-data">Prepare the Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="model_save.html#train-the-model">Train the Model</a></li>
<li class="toctree-l2"><a class="reference internal" href="model_save.html#export-the-model">Export the Model</a></li>
<li class="toctree-l2"><a class="reference internal" href="model_save.html#export-performance-statistics">Export Performance Statistics</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="model_load.html">Loading a Model</a><ul>
<li class="toctree-l2"><a class="reference internal" href="model_load.html#load-data-model">Load Data &amp; Model</a></li>
<li class="toctree-l2"><a class="reference internal" href="model_load.html#harmonize-format">Harmonize Format</a></li>
<li class="toctree-l2"><a class="reference internal" href="model_load.html#make-suggestions">Make Suggestions</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="id_generation.html">Creating a Common Identifier (ID)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="id_generation.html#between-two-sources">Between Two Sources</a><ul>
<li class="toctree-l3"><a class="reference internal" href="id_generation.html#load-data-model">1. Load Data &amp; Model</a></li>
<li class="toctree-l3"><a class="reference internal" href="id_generation.html#harmonize-format">2. Harmonize Format</a></li>
<li class="toctree-l3"><a class="reference internal" href="id_generation.html#generate-a-common-id">3. Generate a Common ID</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="id_generation.html#repeated-cross-sections-panel-id">Repeated Cross-Sections (Panel ID)</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="base.html">Base</a></li>
<li class="toctree-l1"><a class="reference internal" href="model.html">Model</a><ul>
<li class="toctree-l2"><a class="reference internal" href="model.html#neer_match_utilities.model.EpochEndSaver"><code class="docutils literal notranslate"><span class="pre">EpochEndSaver</span></code></a><ul>
<li class="toctree-l3"><a class="reference internal" href="model.html#neer_match_utilities.model.EpochEndSaver.__init__"><code class="docutils literal notranslate"><span class="pre">EpochEndSaver.__init__()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="model.html#neer_match_utilities.model.EpochEndSaver.on_epoch_end"><code class="docutils literal notranslate"><span class="pre">EpochEndSaver.on_epoch_end()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="model.html#neer_match_utilities.model.Model"><code class="docutils literal notranslate"><span class="pre">Model</span></code></a><ul>
<li class="toctree-l3"><a class="reference internal" href="model.html#neer_match_utilities.model.Model.load"><code class="docutils literal notranslate"><span class="pre">Model.load()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="model.html#neer_match_utilities.model.Model.save"><code class="docutils literal notranslate"><span class="pre">Model.save()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="panel.html">Panel</a><ul>
<li class="toctree-l2"><a class="reference internal" href="panel.html#neer_match_utilities.panel.GenerateID"><code class="docutils literal notranslate"><span class="pre">GenerateID</span></code></a><ul>
<li class="toctree-l3"><a class="reference internal" href="panel.html#neer_match_utilities.panel.GenerateID.__init__"><code class="docutils literal notranslate"><span class="pre">GenerateID.__init__()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="panel.html#neer_match_utilities.panel.GenerateID.assign_ids"><code class="docutils literal notranslate"><span class="pre">GenerateID.assign_ids()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="panel.html#neer_match_utilities.panel.GenerateID.execute"><code class="docutils literal notranslate"><span class="pre">GenerateID.execute()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="panel.html#neer_match_utilities.panel.GenerateID.generate_suggestions"><code class="docutils literal notranslate"><span class="pre">GenerateID.generate_suggestions()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="panel.html#neer_match_utilities.panel.GenerateID.group_by_subgroups"><code class="docutils literal notranslate"><span class="pre">GenerateID.group_by_subgroups()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="panel.html#neer_match_utilities.panel.GenerateID.harmonize_ids"><code class="docutils literal notranslate"><span class="pre">GenerateID.harmonize_ids()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="panel.html#neer_match_utilities.panel.GenerateID.relations_left_right"><code class="docutils literal notranslate"><span class="pre">GenerateID.relations_left_right()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="panel.html#neer_match_utilities.panel.SetupData"><code class="docutils literal notranslate"><span class="pre">SetupData</span></code></a><ul>
<li class="toctree-l3"><a class="reference internal" href="panel.html#neer_match_utilities.panel.SetupData.matches"><code class="docutils literal notranslate"><span class="pre">SetupData.matches</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="panel.html#neer_match_utilities.panel.SetupData.__init__"><code class="docutils literal notranslate"><span class="pre">SetupData.__init__()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="panel.html#neer_match_utilities.panel.SetupData.adjust_overlap"><code class="docutils literal notranslate"><span class="pre">SetupData.adjust_overlap()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="panel.html#neer_match_utilities.panel.SetupData.create_connected_groups"><code class="docutils literal notranslate"><span class="pre">SetupData.create_connected_groups()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="panel.html#neer_match_utilities.panel.SetupData.data_preparation_panel"><code class="docutils literal notranslate"><span class="pre">SetupData.data_preparation_panel()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="panel.html#neer_match_utilities.panel.SetupData.drop_repetitions"><code class="docutils literal notranslate"><span class="pre">SetupData.drop_repetitions()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="panel.html#neer_match_utilities.panel.SetupData.panel_preparation"><code class="docutils literal notranslate"><span class="pre">SetupData.panel_preparation()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="prepare.html">Prepare</a><ul>
<li class="toctree-l2"><a class="reference internal" href="prepare.html#neer_match_utilities.prepare.Prepare"><code class="docutils literal notranslate"><span class="pre">Prepare</span></code></a><ul>
<li class="toctree-l3"><a class="reference internal" href="prepare.html#neer_match_utilities.prepare.Prepare.__init__"><code class="docutils literal notranslate"><span class="pre">Prepare.__init__()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="prepare.html#neer_match_utilities.prepare.Prepare.do_remove_stop_words"><code class="docutils literal notranslate"><span class="pre">Prepare.do_remove_stop_words()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="prepare.html#neer_match_utilities.prepare.Prepare.format"><code class="docutils literal notranslate"><span class="pre">Prepare.format()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="prepare.html#neer_match_utilities.prepare.similarity_map_to_dict"><code class="docutils literal notranslate"><span class="pre">similarity_map_to_dict()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="prepare.html#neer_match_utilities.prepare.synth_mismatches"><code class="docutils literal notranslate"><span class="pre">synth_mismatches()</span></code></a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="split.html">Split</a><ul>
<li class="toctree-l2"><a class="reference internal" href="split.html#neer_match_utilities.split.SplitError"><code class="docutils literal notranslate"><span class="pre">SplitError</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="split.html#neer_match_utilities.split.split_test_train"><code class="docutils literal notranslate"><span class="pre">split_test_train()</span></code></a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="training.html">Training</a><ul>
<li class="toctree-l2"><a class="reference internal" href="training.html#neer_match_utilities.training.Training"><code class="docutils literal notranslate"><span class="pre">Training</span></code></a><ul>
<li class="toctree-l3"><a class="reference internal" href="training.html#neer_match_utilities.training.Training.evaluate_dataframe"><code class="docutils literal notranslate"><span class="pre">Training.evaluate_dataframe()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="training.html#neer_match_utilities.training.Training.matches_reorder"><code class="docutils literal notranslate"><span class="pre">Training.matches_reorder()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="training.html#neer_match_utilities.training.Training.performance_statistics_export"><code class="docutils literal notranslate"><span class="pre">Training.performance_statistics_export()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="training.html#neer_match_utilities.training.alpha_balanced"><code class="docutils literal notranslate"><span class="pre">alpha_balanced()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="training.html#neer_match_utilities.training.combined_loss"><code class="docutils literal notranslate"><span class="pre">combined_loss()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="training.html#neer_match_utilities.training.focal_loss"><code class="docutils literal notranslate"><span class="pre">focal_loss()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="training.html#neer_match_utilities.training.soft_f1_loss"><code class="docutils literal notranslate"><span class="pre">soft_f1_loss()</span></code></a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">License</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="LICENSE.html">License</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Neer Match Utilities</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Data Preparation for Training</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/preparation.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section class="tex2jax_ignore mathjax_ignore" id="data-preparation-for-training">
<h1>Data Preparation for Training<a class="headerlink" href="#data-preparation-for-training" title="Link to this heading"></a></h1>
<p>This document explains the data preparation process for training our
matching model. The example data comes from a research project that
digitized historic records of German joint-stock companies <a class="reference external" href="https://dl.acm.org/doi/10.1145/3531533">(Gram et
al. 2022)</a>. The data contains
inconsistencies in spelling, primarily due to variations in abbreviation
conventions and OCR errors, across most variables. These challenges make
it a compelling real-world use case for entity matching.</p>
<p>The data consists of three files:</p>
<ul class="simple">
<li><p><em>left.csv</em></p></li>
<li><p><em>right.csv</em></p></li>
<li><p><em>matches.csv</em></p></li>
</ul>
<section id="different-data-relationships">
<h2>Different Data Relationships<a class="headerlink" href="#different-data-relationships" title="Link to this heading"></a></h2>
<section id="loading-the-data">
<h3>1. Loading the Data<a class="headerlink" href="#loading-the-data" title="Link to this heading"></a></h3>
<p>First, we import the necessary libraries and load the datasets.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">random</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>

<span class="n">matches</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;matches.csv&#39;</span><span class="p">)</span>
<span class="n">left</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;left.csv&#39;</span><span class="p">)</span>
<span class="n">right</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;right.csv&#39;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="inspecting-the-data">
<h3>2. Inspecting the Data<a class="headerlink" href="#inspecting-the-data" title="Link to this heading"></a></h3>
<p>Let’s view the first few rows of each dataset to understand their
structure.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">matches</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
&#10;    .dataframe tbody tr th {
        vertical-align: top;
    }
&#10;    .dataframe thead th {
        text-align: right;
    }
</style>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p></p></th>
<th class="head"><p>company_id_left</p></th>
<th class="head"><p>company_id_right</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>0</p></td>
<td><p>1e87fc75b4</p></td>
<td><p>0008e07878</p></td>
</tr>
<tr class="row-odd"><td><p>1</p></td>
<td><p>810c9c3435</p></td>
<td><p>8bf51ba8a0</p></td>
</tr>
<tr class="row-even"><td><p>2</p></td>
<td><p>571dfb67e2</p></td>
<td><p>90b6db7ed3</p></td>
</tr>
<tr class="row-odd"><td><p>3</p></td>
<td><p>d67d97da08</p></td>
<td><p>b0c68f1152</p></td>
</tr>
<tr class="row-even"><td><p>4</p></td>
<td><p>22ac99ae20</p></td>
<td><p>e9823a3073</p></td>
</tr>
</tbody>
</table>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">left</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
&#10;    .dataframe tbody tr th {
        vertical-align: top;
    }
&#10;    .dataframe thead th {
        text-align: right;
    }
</style>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p></p></th>
<th class="head"><p>company_id</p></th>
<th class="head"><p>oai_identifier</p></th>
<th class="head"><p>company_name</p></th>
<th class="head"><p>company_info_1</p></th>
<th class="head"><p>company_info_2</p></th>
<th class="head"><p>pdf_page_num</p></th>
<th class="head"><p>found_year</p></th>
<th class="head"><p>found_date_modified</p></th>
<th class="head"><p>register_year</p></th>
<th class="head"><p>register_date_modified</p></th>
<th class="head"><p>…</p></th>
<th class="head"><p>effect_year</p></th>
<th class="head"><p>item_rank</p></th>
<th class="head"><p>purpose</p></th>
<th class="head"><p>city</p></th>
<th class="head"><p>bs_text</p></th>
<th class="head"><p>sboard_text</p></th>
<th class="head"><p>proc_text</p></th>
<th class="head"><p>capital_text</p></th>
<th class="head"><p>volume</p></th>
<th class="head"><p>industry</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>0</p></td>
<td><p>1e87fc75b4</p></td>
<td><p>1006345701_18970010</p></td>
<td><p>Glückauf-, Actien-Gesellschaft für Braunkohlen…</p></td>
<td><p>NaN</p></td>
<td><p>NaN</p></td>
<td><p>627</p></td>
<td><p>1871.0</p></td>
<td><p>1871-08-03</p></td>
<td><p>NaN</p></td>
<td><p>NaN</p></td>
<td><p>…</p></td>
<td><p>NaN</p></td>
<td><p>1.0</p></td>
<td><p>Abbau von Braunkohlenlagern u. Brikettfabrikat…</p></td>
<td><p>Lichtenau</p></td>
<td><p>Grundst cke M Grubenwert M Schachtanlagen M Ge…</p></td>
<td><p>sichtsrat Vors Buchh ndler Abel Dietzel Gumper…</p></td>
<td><p>NaN</p></td>
<td><p>M 660 000 in 386 Priorit tsaktien M 1 500</p></td>
<td><p>1</p></td>
<td><p>Bergwerke, Hütten- und Salinenwesen.</p></td>
</tr>
<tr class="row-odd"><td><p>1</p></td>
<td><p>810c9c3435</p></td>
<td><p>1006345701_189900031</p></td>
<td><p>Deutsch-Oesterreichische Mannesmannröhren-Werke</p></td>
<td><p>in Berlin W. u. Düsseldorf mit Zweigniederlass…</p></td>
<td><p>NaN</p></td>
<td><p>501</p></td>
<td><p>1890.0</p></td>
<td><p>1890-07-16</p></td>
<td><p>NaN</p></td>
<td><p>NaN</p></td>
<td><p>…</p></td>
<td><p>NaN</p></td>
<td><p>1.0</p></td>
<td><p>Betrieb der Mannesmannröhren-Walzwerke in Rems…</p></td>
<td><p>Berlin</p></td>
<td><p>Generaldirektion D sseldorf Mobiliar u Utensil…</p></td>
<td><p>Vors Direktor Max Steinthal Stellv Karl v d He…</p></td>
<td><p>Dr M Fuchs A Krusche Berlin G Hethey N Eich</p></td>
<td><p>M 25 900 000 in 23 875 Inhaber Aktien Lit</p></td>
<td><p>3</p></td>
<td><p>Bergwerke, Hütten- und Salinenwesen.</p></td>
</tr>
<tr class="row-even"><td><p>2</p></td>
<td><p>571dfb67e2</p></td>
<td><p>1006345701_191900231</p></td>
<td><p>Handwerkerbank Spaichingen, Akt.-Ges. in Spaic…</p></td>
<td><p>NaN</p></td>
<td><p>NaN</p></td>
<td><p>345</p></td>
<td><p>1889.0</p></td>
<td><p>1889-11-24</p></td>
<td><p>NaN</p></td>
<td><p>NaN</p></td>
<td><p>…</p></td>
<td><p>NaN</p></td>
<td><p>1.0</p></td>
<td><p>Betrieb von Bank- und Kommissionsgeschäften in…</p></td>
<td><p>Spaichingen</p></td>
<td><p>Forderung an Aktion re Immobil Gerichtskosten …</p></td>
<td><p>Vors Wilh Lobmiller Stellv Franz Xav Schmid Sa…</p></td>
<td><p>NaN</p></td>
<td><p>M 600 000 in 600 Aktien M 1000 Urspr M</p></td>
<td><p>23</p></td>
<td><p>Kredit-Banken und andere Geld-Institute.</p></td>
</tr>
<tr class="row-odd"><td><p>3</p></td>
<td><p>d67d97da08</p></td>
<td><p>1006345701_191300172</p></td>
<td><p>Vorschuss-Anstalt für Malchin A.-G.</p></td>
<td><p>NaN</p></td>
<td><p>Letzte Statutänd. 10./7. 1900. Kapital: M. 900…</p></td>
<td><p>165</p></td>
<td><p>NaN</p></td>
<td><p>NaN</p></td>
<td><p>NaN</p></td>
<td><p>NaN</p></td>
<td><p>…</p></td>
<td><p>NaN</p></td>
<td><p>NaN</p></td>
<td><p>NaN</p></td>
<td><p>A</p></td>
<td><p>Forder Effekten u Hypoth Debit Bankguth Kassa …</p></td>
<td><p>W Deutler E Buhr W Fehlow</p></td>
<td><p>NaN</p></td>
<td><p>NaN</p></td>
<td><p>17</p></td>
<td><p>Geld-Institute etc.</p></td>
</tr>
<tr class="row-even"><td><p>4</p></td>
<td><p>22ac99ae20</p></td>
<td><p>1006345701_191200161</p></td>
<td><p>Kaisersteinbruch-Actiengesellschaft in Liqu. i…</p></td>
<td><p>NaN</p></td>
<td><p>NaN</p></td>
<td><p>1443</p></td>
<td><p>1900.0</p></td>
<td><p>1900-03-17</p></td>
<td><p>1900.0</p></td>
<td><p>1900-04-11</p></td>
<td><p>…</p></td>
<td><p>1900.0</p></td>
<td><p>1.0</p></td>
<td><p>Betrieb von Steinhauereien u. aller mit dem Ba…</p></td>
<td><p>Köln</p></td>
<td><p>Steinbr che Steinhauerei Immobil Mannheim Mobi…</p></td>
<td><p>Vors Dr jur P Stephan Rheinbreitbach b Unkel S…</p></td>
<td><p>NaN</p></td>
<td><p>M 450 000 in 150abgest Vorz Aktien u 300 doppelt</p></td>
<td><p>16</p></td>
<td><p>Industrie der Steine und Erden.</p></td>
</tr>
</tbody>
</table>
<p>5 rows × 21 columns</p>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">right</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
&#10;    .dataframe tbody tr th {
        vertical-align: top;
    }
&#10;    .dataframe thead th {
        text-align: right;
    }
</style>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p></p></th>
<th class="head"><p>company_id</p></th>
<th class="head"><p>oai_identifier</p></th>
<th class="head"><p>company_name</p></th>
<th class="head"><p>company_info_1</p></th>
<th class="head"><p>company_info_2</p></th>
<th class="head"><p>pdf_page_num</p></th>
<th class="head"><p>found_year</p></th>
<th class="head"><p>found_date_modified</p></th>
<th class="head"><p>register_year</p></th>
<th class="head"><p>register_date_modified</p></th>
<th class="head"><p>…</p></th>
<th class="head"><p>effect_year</p></th>
<th class="head"><p>item_rank</p></th>
<th class="head"><p>purpose</p></th>
<th class="head"><p>city</p></th>
<th class="head"><p>bs_text</p></th>
<th class="head"><p>sboard_text</p></th>
<th class="head"><p>proc_text</p></th>
<th class="head"><p>capital_text</p></th>
<th class="head"><p>volume</p></th>
<th class="head"><p>industry</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>0</p></td>
<td><p>0008e07878</p></td>
<td><p>1006345701_189800021</p></td>
<td><p>„Glückauf-’, Act.-Ges. für Braunkohlen-Verwert…</p></td>
<td><p>NaN</p></td>
<td><p>NaN</p></td>
<td><p>1038</p></td>
<td><p>1871.0</p></td>
<td><p>1871-08-03</p></td>
<td><p>NaN</p></td>
<td><p>NaN</p></td>
<td><p>…</p></td>
<td><p>NaN</p></td>
<td><p>1.0</p></td>
<td><p>Abbau von Braunkohlenlagern u. Brikettfabrikat…</p></td>
<td><p>NaN</p></td>
<td><p>Grundst cke M Grubenwert M Schachtanlagen M Ge…</p></td>
<td><p>Vors Buchh ndler Abel Dietzel Gumpert Lehmann …</p></td>
<td><p>NaN</p></td>
<td><p>M 660 000 in 386 Vorzugsaktien M 1500 14 Aktien</p></td>
<td><p>2</p></td>
<td><p>Nachtrag.</p></td>
</tr>
<tr class="row-odd"><td><p>1</p></td>
<td><p>8bf51ba8a0</p></td>
<td><p>1006345701_189900032</p></td>
<td><p>Deutsch-Oesterreichische Mannesmannröhren-Werke.</p></td>
<td><p>Sitz in Berlin, Generaldirektion in Düsseldorf…</p></td>
<td><p>NaN</p></td>
<td><p>222</p></td>
<td><p>1890.0</p></td>
<td><p>1890-07-16</p></td>
<td><p>NaN</p></td>
<td><p>NaN</p></td>
<td><p>…</p></td>
<td><p>NaN</p></td>
<td><p>1.0</p></td>
<td><p>Betrieb der Mannesmannröhren-Walzwerke in Rems…</p></td>
<td><p>Berlin</p></td>
<td><p>Generaldirektion Grundst ckskonto M Mobilien U…</p></td>
<td><p>Vors Bankdirektor Max Steinthal Stellv Bankdir…</p></td>
<td><p>Dr M Fuchs A Krusche Berlin G Hethey N Eich</p></td>
<td><p>M 25 900 000 in 23 875 Inhaber Aktien Lit</p></td>
<td><p>3</p></td>
<td><p>Bergwerke, Hütten- und Salinenwesen.</p></td>
</tr>
<tr class="row-even"><td><p>2</p></td>
<td><p>90b6db7ed3</p></td>
<td><p>1006345701_191900232</p></td>
<td><p>Handwerkerbank Spaichingen, Akt.-Ges. in Spaic…</p></td>
<td><p>(in Liquidation).</p></td>
<td><p>NaN</p></td>
<td><p>168</p></td>
<td><p>1889.0</p></td>
<td><p>1889-11-24</p></td>
<td><p>NaN</p></td>
<td><p>NaN</p></td>
<td><p>…</p></td>
<td><p>NaN</p></td>
<td><p>1.0</p></td>
<td><p>Betrieb von Bank- und Kommissionsgeschäften in…</p></td>
<td><p>Spaichingen</p></td>
<td><p>NaN</p></td>
<td><p>Vors Wilh Lobmiller Stellv Frans Nav Schmid Sa…</p></td>
<td><p>NaN</p></td>
<td><p>M 600 000 in 600 Aktien M 1000 Urspr M</p></td>
<td><p>23</p></td>
<td><p>Geld-Institute etc.</p></td>
</tr>
<tr class="row-odd"><td><p>3</p></td>
<td><p>b0c68f1152</p></td>
<td><p>1006345701_191400182</p></td>
<td><p>%% für Malchin A.-G. in Malchin.</p></td>
<td><p>(In Liquidation.) Letzte Statutänd. 10./7. 190…</p></td>
<td><p>NaN</p></td>
<td><p>193</p></td>
<td><p>NaN</p></td>
<td><p>NaN</p></td>
<td><p>NaN</p></td>
<td><p>NaN</p></td>
<td><p>…</p></td>
<td><p>NaN</p></td>
<td><p>NaN</p></td>
<td><p>NaN</p></td>
<td><p>Malchin</p></td>
<td><p>Forder Effekten u Hypoth Debit Bankguth Kassa …</p></td>
<td><p>W Deutler E Buhr W Fehlow</p></td>
<td><p>NaN</p></td>
<td><p>NaN</p></td>
<td><p>18</p></td>
<td><p>Kredit-Banken und andere Geld-Institute.</p></td>
</tr>
<tr class="row-even"><td><p>4</p></td>
<td><p>e9823a3073</p></td>
<td><p>1006345701_190700112</p></td>
<td><p>Kaisersteinbruch-Actiengesellschaft in Köln,</p></td>
<td><p>Zweiggeschäfte in Berlin u. Hamburg.</p></td>
<td><p>NaN</p></td>
<td><p>818</p></td>
<td><p>1900.0</p></td>
<td><p>1900-03-17</p></td>
<td><p>1900.0</p></td>
<td><p>1900-04-11</p></td>
<td><p>…</p></td>
<td><p>1900.0</p></td>
<td><p>1.0</p></td>
<td><p>Betrieb von Steinhauereien u. aller mit dem Ba…</p></td>
<td><p>Köln</p></td>
<td><p>Steinbr che Steinhauerei Grundst ck Mannheim M…</p></td>
<td><p>Vors Rechtsanw Dr jur Max Liertz Stellv Stadtb…</p></td>
<td><p>NaN</p></td>
<td><p>M 900 000 in 900 Aktien wovon 600 abgest M</p></td>
<td><p>11</p></td>
<td><p>Industrie der Steine und Erden.</p></td>
</tr>
</tbody>
</table>
<p>5 rows × 21 columns</p>
</div>
<p>All three DataFrames have the same number of observations:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Number of observations in matches: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">matches</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Number of observations in left: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">left</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Number of observations in right: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">right</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Number of observations in matches: 692
Number of observations in left: 692
Number of observations in right: 692
</pre></div>
</div>
</section>
<section id="simulating-a-many-to-many-relationship">
<h3>3. Simulating a Many-to-Many Relationship<a class="headerlink" href="#simulating-a-many-to-many-relationship" title="Link to this heading"></a></h3>
<p>To demonstrate how to handle more complex matching scenarios, we
simulate a many-to-many (m:m) relationship. For instance, assume that
the company with <code class="docutils literal notranslate"><span class="pre">company_id</span></code> <em>1e87fc75b4</em> in the <em>left</em> DataFrame
should match with two entries in the <em>right</em> DataFrame: the original
match <em>0008e07878</em> and an additional match <em>8bf51ba8a0</em>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Add an extra match to simulate a many-to-many relationship</span>

<span class="n">extra_match</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;company_id_left&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="s1">&#39;1e87fc75b4&#39;</span><span class="p">],</span>
    <span class="s1">&#39;company_id_right&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="s1">&#39;8bf51ba8a0&#39;</span><span class="p">]</span>
<span class="p">})</span>
<span class="n">matches</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">matches</span><span class="p">,</span> <span class="n">extra_match</span><span class="p">],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>Now, inspect the modified <code class="docutils literal notranslate"><span class="pre">matches</span></code> dataframe for the affected IDs:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">matches</span><span class="p">[</span>
    <span class="n">matches</span><span class="p">[</span><span class="s1">&#39;company_id_left&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s1">&#39;1e87fc75b4&#39;</span><span class="p">,</span> <span class="s1">&#39;810c9c3435&#39;</span><span class="p">])</span> <span class="o">|</span>
    <span class="n">matches</span><span class="p">[</span><span class="s1">&#39;company_id_right&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s1">&#39;0008e07878&#39;</span><span class="p">,</span> <span class="s1">&#39;8bf51ba8a0&#39;</span><span class="p">])</span>
<span class="p">]</span>
</pre></div>
</div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
&#10;    .dataframe tbody tr th {
        vertical-align: top;
    }
&#10;    .dataframe thead th {
        text-align: right;
    }
</style>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p></p></th>
<th class="head"><p>company_id_left</p></th>
<th class="head"><p>company_id_right</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>0</p></td>
<td><p>1e87fc75b4</p></td>
<td><p>0008e07878</p></td>
</tr>
<tr class="row-odd"><td><p>1</p></td>
<td><p>810c9c3435</p></td>
<td><p>8bf51ba8a0</p></td>
</tr>
<tr class="row-even"><td><p>692</p></td>
<td><p>1e87fc75b4</p></td>
<td><p>8bf51ba8a0</p></td>
</tr>
</tbody>
</table>
</div>
</section>
<section id="understanding-the-matching-issue">
<h3>4. Understanding the Matching Issue<a class="headerlink" href="#understanding-the-matching-issue" title="Link to this heading"></a></h3>
<p>Simply adding a new row to the <em>matches</em> DataFrame can be problematic.
Consider this simplified example:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Left</p></th>
<th class="head"><p>Right</p></th>
<th class="head"><p>Implied Real-World Entity</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>A</p></td>
<td><p>C</p></td>
<td><p>Entity 1</p></td>
</tr>
<tr class="row-odd"><td><p>B</p></td>
<td><p>D</p></td>
<td><p>Entity 2</p></td>
</tr>
</tbody>
</table>
<p>If further evidence shows that record <em>A</em> and record <em>C</em> represent the
same entity, then all related records (<em>A</em>, <em>B</em>, <em>C</em>, <em>D</em>) should be
grouped together. This comprehensive grouping implies that every
possible pair among these records should be represented (as shown in the
first six rows of the table below). Notice that the observations <em>B</em> and
<em>C</em> would consequently appear in both the <em>Left</em> and <em>Right</em> columns.
Therefore, the <em>left</em> and <em>right</em> DataFrames need to be adjusted,
ensuring these observations will be included in both of these
DataFrames. As a result, the <em>matches</em> DataFrame must be expanded with
an additional set of corresponding entries (highlighted by the
<span style="color: orange;">orange</span> rows):</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Left</p></th>
<th class="head"><p>Right</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>A</p></td>
<td><p>B</p></td>
</tr>
<tr class="row-odd"><td><p>A</p></td>
<td><p>C</p></td>
</tr>
<tr class="row-even"><td><p>A</p></td>
<td><p>D</p></td>
</tr>
<tr class="row-odd"><td><p>B</p></td>
<td><p>C</p></td>
</tr>
<tr class="row-even"><td><p>B</p></td>
<td><p>D</p></td>
</tr>
<tr class="row-odd"><td><p>C</p></td>
<td><p>D</p></td>
</tr>
<tr class="row-even"><td><p><span style="color: orange;">B</span></p></td>
<td><p><span style="color: orange;">B</span></p></td>
</tr>
<tr class="row-odd"><td><p><span style="color: orange;">C</span></p></td>
<td><p><span style="color: orange;">C</span></p></td>
</tr>
</tbody>
</table>
<p>This example highlights why a naive approach (merely adding an extra
match) does not fully capture the nature of the linking problem.</p>
</section>
<section id="correcting-the-relationships">
<h3>5. Correcting the Relationships<a class="headerlink" href="#correcting-the-relationships" title="Link to this heading"></a></h3>
<p>To resolve this issue and correctly group all records representing the
same real-world entity, we use the <code class="docutils literal notranslate"><span class="pre">data_preparation_cs</span></code> method from the
<code class="docutils literal notranslate"><span class="pre">SetupData</span></code> class in the <code class="docutils literal notranslate"><span class="pre">neer_match_utilities.panel</span></code> module. This
method automatically completes the matching pairs and adjusts the <code class="docutils literal notranslate"><span class="pre">left</span></code>
and <code class="docutils literal notranslate"><span class="pre">right</span></code> datasets accordingly.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">neer_match_utilities.panel</span><span class="w"> </span><span class="kn">import</span> <span class="n">SetupData</span>

<span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">,</span> <span class="n">matches</span> <span class="o">=</span> <span class="n">SetupData</span><span class="p">(</span><span class="n">matches</span><span class="o">=</span><span class="n">matches</span><span class="p">)</span><span class="o">.</span><span class="n">data_preparation_cs</span><span class="p">(</span>
    <span class="n">df_left</span><span class="o">=</span><span class="n">left</span><span class="p">,</span>
    <span class="n">df_right</span><span class="o">=</span><span class="n">right</span><span class="p">,</span>
    <span class="n">unique_id</span><span class="o">=</span><span class="s1">&#39;company_id&#39;</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
<section id="verifying-the-adjustments">
<h3>6. Verifying the Adjustments<a class="headerlink" href="#verifying-the-adjustments" title="Link to this heading"></a></h3>
<p>Finally, we verify that the adjustments correctly reflect the intended
relationships by checking the relevant company IDs in the updated
datasets.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Verify the updated matches for the specific company_ids</span>

<span class="n">artificial_group</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;1e87fc75b4&#39;</span><span class="p">,</span> <span class="s1">&#39;810c9c3435&#39;</span><span class="p">,</span> <span class="s1">&#39;0008e07878&#39;</span><span class="p">,</span> <span class="s1">&#39;8bf51ba8a0&#39;</span><span class="p">]</span>

<span class="n">matches_subset</span> <span class="o">=</span> <span class="n">matches</span><span class="p">[</span>
    <span class="n">matches</span><span class="p">[</span><span class="s1">&#39;left&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">artificial_group</span><span class="p">)</span> <span class="o">|</span>
    <span class="n">matches</span><span class="p">[</span><span class="s1">&#39;right&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">artificial_group</span><span class="p">)</span>
<span class="p">]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">([</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="s1">&#39;right&#39;</span><span class="p">])</span>

<span class="n">matches_subset</span>
</pre></div>
</div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
&#10;    .dataframe tbody tr th {
        vertical-align: top;
    }
&#10;    .dataframe thead th {
        text-align: right;
    }
</style>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p></p></th>
<th class="head"><p>left</p></th>
<th class="head"><p>right</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>0</p></td>
<td><p>0008e07878</p></td>
<td><p>1e87fc75b4</p></td>
</tr>
<tr class="row-odd"><td><p>1</p></td>
<td><p>0008e07878</p></td>
<td><p>810c9c3435</p></td>
</tr>
<tr class="row-even"><td><p>2</p></td>
<td><p>0008e07878</p></td>
<td><p>8bf51ba8a0</p></td>
</tr>
<tr class="row-odd"><td><p>696</p></td>
<td><p>1e87fc75b4</p></td>
<td><p>1e87fc75b4</p></td>
</tr>
<tr class="row-even"><td><p>183</p></td>
<td><p>1e87fc75b4</p></td>
<td><p>810c9c3435</p></td>
</tr>
<tr class="row-odd"><td><p>184</p></td>
<td><p>1e87fc75b4</p></td>
<td><p>8bf51ba8a0</p></td>
</tr>
<tr class="row-even"><td><p>705</p></td>
<td><p>810c9c3435</p></td>
<td><p>810c9c3435</p></td>
</tr>
<tr class="row-odd"><td><p>524</p></td>
<td><p>810c9c3435</p></td>
<td><p>8bf51ba8a0</p></td>
</tr>
</tbody>
</table>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Check the corresponding records in the left dataset</span>

<span class="n">left_subset</span> <span class="o">=</span> <span class="n">left</span><span class="p">[</span>
    <span class="n">left</span><span class="p">[</span><span class="s1">&#39;company_id&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">artificial_group</span><span class="p">)</span>
<span class="p">][[</span><span class="s1">&#39;company_id&#39;</span><span class="p">]]</span>
<span class="n">left_subset</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
&#10;    .dataframe tbody tr th {
        vertical-align: top;
    }
&#10;    .dataframe thead th {
        text-align: right;
    }
</style>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p></p></th>
<th class="head"><p>company_id</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>0</p></td>
<td><p>0008e07878</p></td>
</tr>
<tr class="row-odd"><td><p>181</p></td>
<td><p>1e87fc75b4</p></td>
</tr>
<tr class="row-even"><td><p>521</p></td>
<td><p>810c9c3435</p></td>
</tr>
</tbody>
</table>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Check the corresponding records in the right dataset</span>

<span class="n">right_subset</span> <span class="o">=</span> <span class="n">right</span><span class="p">[</span>
    <span class="n">right</span><span class="p">[</span><span class="s1">&#39;company_id&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">artificial_group</span><span class="p">)</span>
<span class="p">][[</span><span class="s1">&#39;company_id&#39;</span><span class="p">]]</span>
<span class="n">right_subset</span>
</pre></div>
</div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
&#10;    .dataframe tbody tr th {
        vertical-align: top;
    }
&#10;    .dataframe thead th {
        text-align: right;
    }
</style>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p></p></th>
<th class="head"><p>company_id</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>19</p></td>
<td><p>1e87fc75b4</p></td>
</tr>
<tr class="row-odd"><td><p>191</p></td>
<td><p>810c9c3435</p></td>
</tr>
<tr class="row-even"><td><p>223</p></td>
<td><p>8bf51ba8a0</p></td>
</tr>
</tbody>
</table>
</div>
<p>By following these steps, we ensure that the data accurately represents
the underlying real-world relationships, even when the matching is more
complex than a simple 1:1 mapping. To not have the manual change affect
the next steps, we drop observations associated with these IDs.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">left</span> <span class="o">=</span> <span class="n">left</span><span class="p">[</span><span class="o">~</span><span class="n">left</span><span class="p">[</span><span class="s1">&#39;company_id&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">artificial_group</span><span class="p">)]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">right</span> <span class="o">=</span> <span class="n">right</span><span class="p">[</span><span class="o">~</span><span class="n">right</span><span class="p">[</span><span class="s1">&#39;company_id&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">artificial_group</span><span class="p">)]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">matches</span> <span class="o">=</span> <span class="n">matches</span><span class="p">[</span>
    <span class="p">(</span><span class="o">~</span><span class="n">matches</span><span class="p">[</span><span class="s1">&#39;left&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">artificial_group</span><span class="p">))</span>
    <span class="o">&amp;</span>
    <span class="p">(</span><span class="o">~</span><span class="n">matches</span><span class="p">[</span><span class="s1">&#39;right&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">artificial_group</span><span class="p">))</span>
<span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<hr class="docutils" />
<section id="formatting">
<h2>Formatting<a class="headerlink" href="#formatting" title="Link to this heading"></a></h2>
<section id="a-customized-similarity-map">
<h3>1. A customized <code class="docutils literal notranslate"><span class="pre">similarity_map</span></code><a class="headerlink" href="#a-customized-similarity-map" title="Link to this heading"></a></h3>
<p>Set up the <code class="docutils literal notranslate"><span class="pre">similarity_map</span></code>. Note that the columns as <code class="docutils literal notranslate"><span class="pre">city</span></code>,
<code class="docutils literal notranslate"><span class="pre">industry</span></code>, and <code class="docutils literal notranslate"><span class="pre">purpose</span></code> contain missing values. One way to improve the
handling of these is to include a custom <a class="reference external" href="https://github.com/maliedvp/py-neer-match/blob/custom_similarity_functions/src/neer_match/similarity_map.py">similarity
function</a>
<code class="docutils literal notranslate"><span class="pre">notmissing</span></code> to the <code class="docutils literal notranslate"><span class="pre">similarity_map</span></code> that returns 0 if a least one
observation of a record pair is any missing value (<code class="docutils literal notranslate"><span class="pre">None</span></code>, <code class="docutils literal notranslate"><span class="pre">np.nan</span></code>,
<code class="docutils literal notranslate"><span class="pre">pd.nan</span></code> or and empty string) and 1 otherwise. Similarly, for numeric
columns, the custom function <code class="docutils literal notranslate"><span class="pre">notzero</span></code> is added. These functions are not
part of the released version of
<code class="docutils literal notranslate"><span class="pre">neer_match.similarity_map.available_similarities()</span></code>, which is why they
are outcommented in the example below.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">neer_match.similarity_map</span><span class="w"> </span><span class="kn">import</span> <span class="n">SimilarityMap</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">neer_match_utilities.custom_similarities</span><span class="w"> </span><span class="kn">import</span> <span class="n">CustomSimilarities</span>

<span class="c1"># Load custom similarities dedicated to missing values from the utilities package</span>

<span class="n">CustomSimilarities</span><span class="p">()</span>

<span class="c1"># Define similarity_map</span>

<span class="n">similarity_map</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;company_name&quot;</span> <span class="p">:</span> <span class="p">[</span>
        <span class="s2">&quot;levenshtein&quot;</span><span class="p">,</span>
        <span class="s2">&quot;jaro_winkler&quot;</span><span class="p">,</span>
        <span class="s2">&quot;prefix&quot;</span><span class="p">,</span>
        <span class="s2">&quot;postfix&quot;</span><span class="p">,</span>
        <span class="s2">&quot;token_sort_ratio&quot;</span><span class="p">,</span>
        <span class="s2">&quot;token_set_ratio&quot;</span><span class="p">,</span>
        <span class="s2">&quot;partial_token_set_ratio&quot;</span><span class="p">,</span>
        <span class="s2">&quot;partial_token_sort_ratio&quot;</span><span class="p">,</span>
    <span class="p">],</span>
    <span class="s2">&quot;city&quot;</span> <span class="p">:</span> <span class="p">[</span>
        <span class="s2">&quot;levenshtein&quot;</span><span class="p">,</span>
        <span class="s2">&quot;jaro_winkler&quot;</span><span class="p">,</span>
        <span class="s2">&quot;notmissing&quot;</span><span class="p">,</span>
    <span class="p">],</span>
    <span class="s2">&quot;industry&quot;</span> <span class="p">:</span> <span class="p">[</span>
        <span class="s2">&quot;levenshtein&quot;</span><span class="p">,</span>
        <span class="s2">&quot;jaro_winkler&quot;</span><span class="p">,</span>
        <span class="s2">&quot;notmissing&quot;</span><span class="p">,</span>
    <span class="p">],</span>
    <span class="s2">&quot;purpose&quot;</span> <span class="p">:</span> <span class="p">[</span>
        <span class="s2">&quot;levenshtein&quot;</span><span class="p">,</span>
        <span class="s2">&quot;jaro_winkler&quot;</span><span class="p">,</span>
        <span class="s2">&quot;token_sort_ratio&quot;</span><span class="p">,</span>
        <span class="s2">&quot;token_set_ratio&quot;</span><span class="p">,</span>
        <span class="s2">&quot;partial_token_set_ratio&quot;</span><span class="p">,</span>
        <span class="s2">&quot;partial_token_sort_ratio&quot;</span><span class="p">,</span>
        <span class="s2">&quot;notmissing&quot;</span><span class="p">,</span>
    <span class="p">],</span>
    <span class="s2">&quot;bs_text&quot;</span> <span class="p">:</span> <span class="p">[</span>
        <span class="s2">&quot;levenshtein&quot;</span><span class="p">,</span>
        <span class="s2">&quot;jaro_winkler&quot;</span><span class="p">,</span>
        <span class="s2">&quot;token_sort_ratio&quot;</span><span class="p">,</span>
        <span class="s2">&quot;token_set_ratio&quot;</span><span class="p">,</span>
        <span class="s2">&quot;partial_token_set_ratio&quot;</span><span class="p">,</span>
        <span class="s2">&quot;partial_token_sort_ratio&quot;</span><span class="p">,</span>
        <span class="s2">&quot;notmissing&quot;</span><span class="p">,</span>
    <span class="p">],</span>
    <span class="s2">&quot;found_year&quot;</span> <span class="p">:</span> <span class="p">[</span>
        <span class="s2">&quot;discrete&quot;</span><span class="p">,</span>
        <span class="s2">&quot;notzero&quot;</span>
    <span class="p">],</span>
    <span class="s2">&quot;found_date_modified&quot;</span> <span class="p">:</span> <span class="p">[</span>
        <span class="s2">&quot;discrete&quot;</span><span class="p">,</span>
        <span class="s2">&quot;notmissing&quot;</span><span class="p">,</span>
    <span class="p">]</span>
<span class="p">}</span>

<span class="n">smap</span> <span class="o">=</span> <span class="n">SimilarityMap</span><span class="p">(</span><span class="n">similarity_map</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="harmonizing-the-data">
<h3>2. Harmonizing the data<a class="headerlink" href="#harmonizing-the-data" title="Link to this heading"></a></h3>
<p>Next, data formatting can be harmonized using the <code class="docutils literal notranslate"><span class="pre">Prepare</span></code> class. This
class enables operations such as capitalizing string variables and
converting other values to numeric types. Importantly, these operations
are applied consistently to both the <em>left</em> and <em>right</em> DataFrames.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">neer_match_utilities.prepare</span><span class="w"> </span><span class="kn">import</span> <span class="n">Prepare</span>

<span class="c1"># Initialize the Prepare object</span>

<span class="n">prepare</span> <span class="o">=</span> <span class="n">Prepare</span><span class="p">(</span>
    <span class="n">similarity_map</span><span class="o">=</span><span class="n">similarity_map</span><span class="p">,</span> 
    <span class="n">df_left</span><span class="o">=</span><span class="n">left</span><span class="p">,</span> 
    <span class="n">df_right</span><span class="o">=</span><span class="n">right</span><span class="p">,</span> 
    <span class="n">id_left</span><span class="o">=</span><span class="s1">&#39;company_id&#39;</span><span class="p">,</span> 
    <span class="n">id_right</span><span class="o">=</span><span class="s1">&#39;company_id&#39;</span><span class="p">,</span>
    <span class="n">spacy_pipeline</span><span class="o">=</span><span class="s1">&#39;de_core_news_sm&#39;</span><span class="p">,</span>
    <span class="n">additional_stop_words</span><span class="o">=</span><span class="p">[]</span>
<span class="p">)</span>

<span class="c1"># Get formatted and harmonized datasets</span>

<span class="n">left</span><span class="p">,</span> <span class="n">right</span> <span class="o">=</span> <span class="n">prepare</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
    <span class="n">fill_numeric_na</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">to_numeric</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;found_year&#39;</span><span class="p">],</span>
    <span class="n">fill_string_na</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
    <span class="n">capitalize</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">lower_case</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">remove_stop_words</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">left</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
&#10;    .dataframe tbody tr th {
        vertical-align: top;
    }
&#10;    .dataframe thead th {
        text-align: right;
    }
</style>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p></p></th>
<th class="head"><p>company_id</p></th>
<th class="head"><p>company_name</p></th>
<th class="head"><p>city</p></th>
<th class="head"><p>industry</p></th>
<th class="head"><p>purpose</p></th>
<th class="head"><p>bs_text</p></th>
<th class="head"><p>found_year</p></th>
<th class="head"><p>found_date_modified</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>0</p></td>
<td><p>008fbe2454</p></td>
<td><p>BETRAG IN RÜCKZAHLBAR VERSTÄRKTE</p></td>
<td><p>RÜCKZAHLBAR</p></td>
<td><p>ELEKTRISCHE STRASSENBAHNEN, KLEIN- UND PFERDEB…</p></td>
<td><p></p></td>
<td><p>BAHNH FE U GRUNDST CKE BAHNBAU U H LEITUNG MOT…</p></td>
<td><p>NaN</p></td>
<td><p></p></td>
</tr>
<tr class="row-odd"><td><p>1</p></td>
<td><p>00a050af9d</p></td>
<td><p>ZUCKERFABRIK HARSUM IN HARSUM, PROV. HANNOVER.</p></td>
<td><p>HANNOVER</p></td>
<td><p>ZUCKER-FABRIKEN UND ZUCKER-RAFFINERIEN.</p></td>
<td><p>FABRIKATION VON ROHZUCKER. PRODUKTION 1896/97–…</p></td>
<td><p>GRUNDST CK M GEB UDE M MASCHINEN U APPARATE M</p></td>
<td><p>1873.0</p></td>
<td><p>1873-08-03</p></td>
</tr>
<tr class="row-even"><td><p>2</p></td>
<td><p>00ce66e5a8</p></td>
<td><p>AKTIENGESELLSCHAFT FÜR LINIIR-APPARATE, PATENT…</p></td>
<td><p>LEIPZIG</p></td>
<td><p>METALL-INDUSTRIE.</p></td>
<td><p>ERWERB, AUSBEUTUNG UND SONSTIGE VERWERTUNG DER…</p></td>
<td><p>PATENTE BETRIEBSMASCHINEN INVENTAR UTENSIL WAR…</p></td>
<td><p>1899.0</p></td>
<td><p>1899-04-28</p></td>
</tr>
<tr class="row-odd"><td><p>3</p></td>
<td><p>00d74f0e0b</p></td>
<td><p>DEUTSCHE RÜCK- U. MITVERSICHERUNGS-GESELLSCHAF…</p></td>
<td><p>BERLIN</p></td>
<td><p>VERSICHERUNGS-GESELLSCHAFTEN ALLER BRANCHEN.</p></td>
<td><p></p></td>
<td><p>AKTIENWECHSEL M EFFEKTEN M HYP DARLEHEN M INVE…</p></td>
<td><p>1885.0</p></td>
<td><p>1885-03-12</p></td>
</tr>
<tr class="row-even"><td><p>4</p></td>
<td><p>01077b1f46</p></td>
<td><p>GEBRÜDER ZSCHILLE TUCHFABRIK</p></td>
<td><p>GROSSENHAIN</p></td>
<td><p>TEXTIL-INDUSTRIE.</p></td>
<td><p>ÜBERNAHME UND FORTBETRIEB DER DER FIRMA GEBR. …</p></td>
<td><p></p></td>
<td><p>1899.0</p></td>
<td><p>1899-09-18</p></td>
</tr>
</tbody>
</table>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">right</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
&#10;    .dataframe tbody tr th {
        vertical-align: top;
    }
&#10;    .dataframe thead th {
        text-align: right;
    }
</style>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p></p></th>
<th class="head"><p>company_id</p></th>
<th class="head"><p>company_name</p></th>
<th class="head"><p>city</p></th>
<th class="head"><p>industry</p></th>
<th class="head"><p>purpose</p></th>
<th class="head"><p>bs_text</p></th>
<th class="head"><p>found_year</p></th>
<th class="head"><p>found_date_modified</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>0</p></td>
<td><p>0562ddb063</p></td>
<td><p>DEUTSCHE GAS-SELBSTZÜNDER-A.-G. IN BERLIN, HOL…</p></td>
<td><p>BERLIN</p></td>
<td><p>GESELLSCHAFTEN FÜR GAS-, PETROLEUM- UND SPIRIT…</p></td>
<td><p>HERSTELLUNG U. VERTRIEB VON GASSELBSTZÜNDERN, …</p></td>
<td><p>KASSA BANKGUTH AUSSENST NDE VORSCHUSS ZAHLUNG …</p></td>
<td><p>1897.0</p></td>
<td><p>1897-03-13</p></td>
</tr>
<tr class="row-odd"><td><p>1</p></td>
<td><p>05cdac2565</p></td>
<td><p>ACT.-GES. FÜR GRUNDBESITZ U. HYPOTHEKENVERKEHR…</p></td>
<td><p>BERLIN</p></td>
<td><p>BAU-BANKEN, BAU-, TERRAIN- UND IMMOBILIEN-GESE…</p></td>
<td><p></p></td>
<td><p>IMMOBIL I DO II EIG HYPOTH WERTP PFLASTERKAUTI…</p></td>
<td><p>1883.0</p></td>
<td><p>1883-06-16</p></td>
</tr>
<tr class="row-even"><td><p>2</p></td>
<td><p>0a1e2ae043</p></td>
<td><p>KIELER DOCK GESELLSCHAFT J. W. SEIBEL IN KIEL.</p></td>
<td><p>KIEL</p></td>
<td><p>SCHIFFSBAU-ANSTALTEN UND DOCK-GESELLSCHAFTEN.</p></td>
<td><p>ERWERB U. BETRIEB VON SCHWIMMDOCKS. GEDOCKT WU…</p></td>
<td><p>DOCKBAU INVENTAR KASSA BANKGUTH SWENTINE DOCK …</p></td>
<td><p>1876.0</p></td>
<td><p>1876-08-03</p></td>
</tr>
<tr class="row-odd"><td><p>3</p></td>
<td><p>0bab236590</p></td>
<td><p>HESSISCHE EISENBAHN-AKTIENGESELLSCHAFT IN DARM…</p></td>
<td><p>DARMSTADT</p></td>
<td><p>ELEKTRISCHE STRASSENBAHNEN, KLEIN- UND PFERDEB…</p></td>
<td><p>ERBAUUNG, ERWERBUNG, PACHTUNG U. BETRIEB VON B…</p></td>
<td><p></p></td>
<td><p>1912.0</p></td>
<td><p>1912-04-15</p></td>
</tr>
<tr class="row-even"><td><p>4</p></td>
<td><p>1090024903</p></td>
<td><p>* BEVENSER MASCHINENFABRIK AKT.-GES. IN BEVENSEN</p></td>
<td><p>BEVENSEN</p></td>
<td><p>MASCHINEN- UND ARMATUREN-FABRIKEN, EISENGIESSE…</p></td>
<td><p>ÜBERNAHME U. FORTBETRIEB DES FABRIKATIONS- U. …</p></td>
<td><p></p></td>
<td><p>1909.0</p></td>
<td><p>1909-04-24</p></td>
</tr>
</tbody>
</table>
</div>
</section>
</section>
<section id="re-structuring">
<h2>Re-Structuring<a class="headerlink" href="#re-structuring" title="Link to this heading"></a></h2>
<p><code class="docutils literal notranslate"><span class="pre">neer-match</span></code> requires that the <em>matches</em> DataFrame be structured with
the indices from the left and right datasets instead of their unique
IDs. To convert your <em>matches</em> DataFrame into the required format, you
can run:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">neer_match_utilities.training</span><span class="w"> </span><span class="kn">import</span> <span class="n">Training</span>

<span class="n">training</span> <span class="o">=</span> <span class="n">Training</span><span class="p">(</span>
    <span class="n">similarity_map</span><span class="o">=</span><span class="n">similarity_map</span><span class="p">,</span> 
    <span class="n">df_left</span><span class="o">=</span><span class="n">left</span><span class="p">,</span> 
    <span class="n">df_right</span><span class="o">=</span><span class="n">right</span><span class="p">,</span> 
    <span class="n">id_left</span><span class="o">=</span><span class="s1">&#39;company_id&#39;</span><span class="p">,</span> 
    <span class="n">id_right</span><span class="o">=</span><span class="s1">&#39;company_id&#39;</span>
<span class="p">)</span>

<span class="n">matches</span> <span class="o">=</span> <span class="n">training</span><span class="o">.</span><span class="n">matches_reorder</span><span class="p">(</span>
    <span class="n">matches</span><span class="p">,</span> 
    <span class="n">matches_id_left</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> 
    <span class="n">matches_id_right</span><span class="o">=</span><span class="s1">&#39;right&#39;</span>
<span class="p">)</span>

<span class="n">matches</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
&#10;    .dataframe tbody tr th {
        vertical-align: top;
    }
&#10;    .dataframe thead th {
        text-align: right;
    }
</style>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p></p></th>
<th class="head"><p>left</p></th>
<th class="head"><p>right</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>0</p></td>
<td><p>0</p></td>
<td><p>34</p></td>
</tr>
<tr class="row-odd"><td><p>1</p></td>
<td><p>1</p></td>
<td><p>267</p></td>
</tr>
<tr class="row-even"><td><p>2</p></td>
<td><p>2</p></td>
<td><p>141</p></td>
</tr>
<tr class="row-odd"><td><p>3</p></td>
<td><p>3</p></td>
<td><p>46</p></td>
</tr>
<tr class="row-even"><td><p>4</p></td>
<td><p>4</p></td>
<td><p>149</p></td>
</tr>
</tbody>
</table>
</div>
<p>Let’s track down the observations from <em>matches</em> in <em>left</em> .</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">left_index</span> <span class="o">=</span> <span class="n">matches</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="s1">&#39;left&#39;</span><span class="p">]</span>
<span class="n">left</span><span class="p">[</span><span class="n">left</span><span class="o">.</span><span class="n">index</span><span class="o">==</span><span class="n">left_index</span><span class="p">]</span>
</pre></div>
</div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
&#10;    .dataframe tbody tr th {
        vertical-align: top;
    }
&#10;    .dataframe thead th {
        text-align: right;
    }
</style>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p></p></th>
<th class="head"><p>company_id</p></th>
<th class="head"><p>company_name</p></th>
<th class="head"><p>city</p></th>
<th class="head"><p>industry</p></th>
<th class="head"><p>purpose</p></th>
<th class="head"><p>bs_text</p></th>
<th class="head"><p>found_year</p></th>
<th class="head"><p>found_date_modified</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>4</p></td>
<td><p>01077b1f46</p></td>
<td><p>GEBRÜDER ZSCHILLE TUCHFABRIK</p></td>
<td><p>GROSSENHAIN</p></td>
<td><p>TEXTIL-INDUSTRIE.</p></td>
<td><p>ÜBERNAHME UND FORTBETRIEB DER DER FIRMA GEBR. …</p></td>
<td><p></p></td>
<td><p>1899.0</p></td>
<td><p>1899-09-18</p></td>
</tr>
</tbody>
</table>
</div>
<p>and <em>right</em></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">right_index</span> <span class="o">=</span> <span class="n">matches</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="s1">&#39;right&#39;</span><span class="p">]</span>
<span class="n">right</span><span class="p">[</span><span class="n">right</span><span class="o">.</span><span class="n">index</span><span class="o">==</span><span class="n">right_index</span><span class="p">]</span>
</pre></div>
</div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
&#10;    .dataframe tbody tr th {
        vertical-align: top;
    }
&#10;    .dataframe thead th {
        text-align: right;
    }
</style>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p></p></th>
<th class="head"><p>company_id</p></th>
<th class="head"><p>company_name</p></th>
<th class="head"><p>city</p></th>
<th class="head"><p>industry</p></th>
<th class="head"><p>purpose</p></th>
<th class="head"><p>bs_text</p></th>
<th class="head"><p>found_year</p></th>
<th class="head"><p>found_date_modified</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>149</p></td>
<td><p>721ce62f33</p></td>
<td><p>GEBRÜDER ZSCHILLE TUCHFABRIK AKTIENGESELLSCHAF…</p></td>
<td><p>GROSSENHAIN</p></td>
<td><p>TEXTIL-INDUSTRIE.</p></td>
<td><p>ÜBERNAHME UND FORTBETRIEB DER DER FIRMA GEBR. …</p></td>
<td><p>GRUNDST CKE U GEB UDE MASCHINEN U UTENSILIEN F…</p></td>
<td><p>1899.0</p></td>
<td><p>1899-09-18</p></td>
</tr>
</tbody>
</table>
</div>
</section>
<section id="splitting-data">
<h2>Splitting data<a class="headerlink" href="#splitting-data" title="Link to this heading"></a></h2>
<p>Subsequently, we need to split the data into training and test sets,
each consisting of three DataFrames. The training ratio is given by
<span class="math notranslate nohighlight">\(\text{training_ratio} = 1 - (\text{test_ratio} + \text{validation_ratio})\)</span>.
Note that since validation is not implemented yet, you can set
<span class="math notranslate nohighlight">\(\text{validation_ratio} = 0\)</span>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">neer_match_utilities.split</span><span class="w"> </span><span class="kn">import</span> <span class="n">split_test_train</span>

<span class="n">left_train</span><span class="p">,</span> <span class="n">right_train</span><span class="p">,</span> <span class="n">matches_train</span><span class="p">,</span> <span class="n">left_validation</span><span class="p">,</span> <span class="n">right_validation</span><span class="p">,</span> <span class="n">matches_validation</span><span class="p">,</span> <span class="n">left_test</span><span class="p">,</span> <span class="n">right_test</span><span class="p">,</span> <span class="n">matches_test</span> <span class="o">=</span> <span class="n">split_test_train</span><span class="p">(</span>
    <span class="n">left</span> <span class="o">=</span> <span class="n">left</span><span class="p">,</span>
    <span class="n">right</span> <span class="o">=</span> <span class="n">right</span><span class="p">,</span>
    <span class="n">matches</span> <span class="o">=</span> <span class="n">matches</span><span class="p">,</span>
    <span class="n">test_ratio</span> <span class="o">=</span> <span class="mf">.5</span><span class="p">,</span>
    <span class="n">validation_ratio</span> <span class="o">=</span> <span class="mf">.0</span>
<span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">matches_train</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
&#10;    .dataframe tbody tr th {
        vertical-align: top;
    }
&#10;    .dataframe thead th {
        text-align: right;
    }
</style>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p></p></th>
<th class="head"><p>left</p></th>
<th class="head"><p>right</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>0</p></td>
<td><p>0</p></td>
<td><p>204</p></td>
</tr>
<tr class="row-odd"><td><p>1</p></td>
<td><p>1</p></td>
<td><p>3</p></td>
</tr>
<tr class="row-even"><td><p>2</p></td>
<td><p>2</p></td>
<td><p>89</p></td>
</tr>
<tr class="row-odd"><td><p>3</p></td>
<td><p>3</p></td>
<td><p>257</p></td>
</tr>
<tr class="row-even"><td><p>4</p></td>
<td><p>4</p></td>
<td><p>222</p></td>
</tr>
</tbody>
</table>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">left_train</span><span class="p">[</span>
    <span class="n">left_train</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span>
        <span class="n">matches_train</span><span class="p">[</span><span class="s1">&#39;left&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
    <span class="p">)</span>
<span class="p">]</span>
</pre></div>
</div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
&#10;    .dataframe tbody tr th {
        vertical-align: top;
    }
&#10;    .dataframe thead th {
        text-align: right;
    }
</style>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p></p></th>
<th class="head"><p>company_id</p></th>
<th class="head"><p>company_name</p></th>
<th class="head"><p>city</p></th>
<th class="head"><p>industry</p></th>
<th class="head"><p>purpose</p></th>
<th class="head"><p>bs_text</p></th>
<th class="head"><p>found_year</p></th>
<th class="head"><p>found_date_modified</p></th>
<th class="head"><p>index_original</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>0</p></td>
<td><p>022f81a1cb</p></td>
<td><p>BERLINER KRONEN-BRAUEREI ACTIENGESELLSCHAFT IN…</p></td>
<td><p>BERLIN</p></td>
<td><p>BRAUEREIEN.</p></td>
<td><p>BIERBRAUEREIBETRIEB. ABSATZ CA. 45 676 HL. KAP…</p></td>
<td><p>GRUNDST CKE U MIETSH USER M BRAUEREIGEB UDE M …</p></td>
<td><p>1891.0</p></td>
<td><p>1891-08-03</p></td>
<td><p>7</p></td>
</tr>
<tr class="row-odd"><td><p>1</p></td>
<td><p>029832df3c</p></td>
<td><p>KUR-U. WASSERHEILANSTALT ZU GODESBERG AKTIEN-G…</p></td>
<td><p>GODESBERG</p></td>
<td><p>BÄDER, QUELLEN-PRODUKTE, WASCH-ANSTALTEN ETC.</p></td>
<td><p></p></td>
<td><p>IMMOBILIEN MOBILIEN BANKGUTHABEN KASSA PASSIVA…</p></td>
<td><p>1900.0</p></td>
<td><p>1900-08-03</p></td>
<td><p>10</p></td>
</tr>
<tr class="row-even"><td><p>2</p></td>
<td><p>0325788dc4</p></td>
<td><p>METALL ZIEHEFEF AKT.-GES. IN CÖLN-EHRENFELD.</p></td>
<td><p>CÖLN-EHRENFELD</p></td>
<td><p>METALL-INDUSTRIE.</p></td>
<td><p>ERWERB U. WEITERBETRIEB DER VON DER FIRMA EUGEN</p></td>
<td><p>WURDE ENTGEGEN DEN GESETZL BESTIMMUNGEN NOCH N…</p></td>
<td><p>1906.0</p></td>
<td><p>1906-11-29</p></td>
<td><p>11</p></td>
</tr>
<tr class="row-odd"><td><p>3</p></td>
<td><p>03d559a18b</p></td>
<td><p>MEMELER KLEINBAHN-AKT.-GES. IN MEMEL.</p></td>
<td><p>MEMEL</p></td>
<td><p>ELEKTRISCHE STRASSENBAHNEN, KLEIN- UND PFERDEB…</p></td>
<td><p>BAU U. DER BETRIEB FOLGENDER KLEINBAHNLINIEN: …</p></td>
<td><p></p></td>
<td><p>1904.0</p></td>
<td><p>1904-04-15</p></td>
<td><p>15</p></td>
</tr>
<tr class="row-even"><td><p>4</p></td>
<td><p>04d4f1304a</p></td>
<td><p>ACTIEN-BIERBRAUEREI MEISSNER FELSENKELLER IN M…</p></td>
<td><p>MEISSEN</p></td>
<td><p>BRAUEREIEN.</p></td>
<td><p>BIERBRAUEREIBETRIEB. SPECIFIKATION DES BESITZT…</p></td>
<td><p>IMMOBILIEN MASCHINEN GEF SSE PFERDE WAGEN U GE…</p></td>
<td><p>1885.0</p></td>
<td><p>1885-08-03</p></td>
<td><p>16</p></td>
</tr>
</tbody>
</table>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">right_train</span><span class="p">[</span>
    <span class="n">right_train</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span>
        <span class="n">matches_train</span><span class="p">[</span><span class="s1">&#39;right&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
    <span class="p">)</span>
<span class="p">]</span>
</pre></div>
</div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
&#10;    .dataframe tbody tr th {
        vertical-align: top;
    }
&#10;    .dataframe thead th {
        text-align: right;
    }
</style>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p></p></th>
<th class="head"><p>company_id</p></th>
<th class="head"><p>company_name</p></th>
<th class="head"><p>city</p></th>
<th class="head"><p>industry</p></th>
<th class="head"><p>purpose</p></th>
<th class="head"><p>bs_text</p></th>
<th class="head"><p>found_year</p></th>
<th class="head"><p>found_date_modified</p></th>
<th class="head"><p>index_original</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>3</p></td>
<td><p>127292ac62</p></td>
<td><p>KUR- U. WASSERHEILANSTALT GODESBERG AKTIEN-GES…</p></td>
<td><p>GODESBERG</p></td>
<td><p>BÄDER, QUELLEN-PRODUKTE, WASCH-ANSTALTEN ETC.</p></td>
<td><p>BETRIEB EINER KUR- U. WASSÉRHEILANSTALT.</p></td>
<td><p>IMMOBIL MOBIL BANKGUTH DEPOSITENKASSE KASSA EF…</p></td>
<td><p>1900.0</p></td>
<td><p>1900-02-28</p></td>
<td><p>13</p></td>
</tr>
<tr class="row-odd"><td><p>89</p></td>
<td><p>7c118c147f</p></td>
<td><p>METALL-ZIEHEREI AKT.-GES. IN CÖLN-KHRENFELD.</p></td>
<td><p>CÖLN-KHRENFELD</p></td>
<td><p>METALL-INDUSTRIE.</p></td>
<td><p>ERWERB U. WEITERBETRIEB DER VON DER FIRMA EUGEN</p></td>
<td><p>AKTIVA GRUNDST CK GEB UDE MASCH R WERKZEUG FUH…</p></td>
<td><p>1906.0</p></td>
<td><p>1906-11-29</p></td>
<td><p>174</p></td>
</tr>
<tr class="row-even"><td><p>204</p></td>
<td><p>c2b13c295b</p></td>
<td><p>BERLINER KRONEN-BRAUEREI ACTIENGESELLSCHAFT IN…</p></td>
<td><p>BERLIN</p></td>
<td><p>BRAUEREIEN.</p></td>
<td><p>BIERBRAUEREIBETRIEB. BIERABSATZ 1895/96–1897/9…</p></td>
<td><p></p></td>
<td><p>1891.0</p></td>
<td><p>1891-08-03</p></td>
<td><p>417</p></td>
</tr>
<tr class="row-odd"><td><p>222</p></td>
<td><p>cab76e9bfa</p></td>
<td><p>ACTIEN-BIERBRAUEREI MEISSNER FELSENKELLER IN M…</p></td>
<td><p>MEISSEN</p></td>
<td><p>BRAUEREIEN.</p></td>
<td><p>BIERBRAUEREIBETRIEB. SPECIFIKATION DES BESITZT…</p></td>
<td><p>IMMOBILIEN MASCHINEN GEF SSE PFERDE WAGEN U GE…</p></td>
<td><p>1885.0</p></td>
<td><p>1885-08-03</p></td>
<td><p>450</p></td>
</tr>
<tr class="row-even"><td><p>257</p></td>
<td><p>dbe2526e6d</p></td>
<td><p>MEMELER KLEINBAHN-AKT.-GES. IN MEMEL.</p></td>
<td><p>MEMEL</p></td>
<td><p>ELEKTRISCHE STRASSENBAHNEN, KLEIN- UND PFERDEB…</p></td>
<td><p>BAU U. DER BETRIEB FOLGENDER KLEINBAHNLINIEN: …</p></td>
<td><p></p></td>
<td><p>1904.0</p></td>
<td><p>1904-04-15</p></td>
<td><p>520</p></td>
</tr>
</tbody>
</table>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="install.html" class="btn btn-neutral float-left" title="Installation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="model_save.html" class="btn btn-neutral float-right" title="Saving a Model" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Pantelis Karapanagiotis, Marius Liebald.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>